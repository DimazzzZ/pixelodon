<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Authentication Complete</title>
    <script>
        // This script handles both query parameters and URI fragments
        function getCallbackData() {
            var params = {};
            // Get query parameters
            var search = window.location.search.substring(1);
            if (search) {
                var pairs = search.split('&');
                for (var i = 0; i < pairs.length; i++) {
                    var pair = pairs[i].split('=');
                    params[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || '');
                }
            }
            // Get fragment parameters (some OAuth providers use fragments)
            var hash = window.location.hash.substring(1);
            if (hash) {
                var pairs = hash.split('&');
                for (var i = 0; i < pairs.length; i++) {
                    var pair = pairs[i].split('=');
                    params[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || '');
                }
            }
            return params;
        }

        window.onload = function() {
            var params = getCallbackData();
            // Construct the callback URL
            var callbackUrl = 'pixelodon://oauth/callback';
            var first = true;
            for (var key in params) {
                callbackUrl += first ? '?' : '&';
                callbackUrl += encodeURIComponent(key) + '=' + encodeURIComponent(params[key]);
                first = false;
            }
            // Redirect back to the app
            window.location.replace(callbackUrl);
        }
    </script>
</head>
<body>
    <h1>Authentication Complete</h1>
    <p>This window should close automatically. If it doesn't, you can close it and return to the app.</p>
</body>
</html>
